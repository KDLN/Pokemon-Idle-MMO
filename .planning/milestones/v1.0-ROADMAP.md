# Milestone v1.0: Guilds

**Status:** ✅ SHIPPED 2026-01-19
**Phases:** 1-7
**Total Plans:** 27

## Overview

This roadmap transformed Pokemon Idle MMO from a solo idle experience into a social, cooperative game through a comprehensive guild system. Players can create or join guilds to share resources, complete quests together, purchase group buffs, and compete on leaderboards. The milestone also expanded the game world with Cerulean City, Misty's Gym, and Routes 24-25.

Phases were ordered by dependency: foundation before features, simpler features before complex ones, content last (independent of guild mechanics).

---

## Phases

### Phase 1: Guild Foundation

**Goal:** Players can create, join, and manage guilds with role-based permissions.

**Requirements:** GUILD-01, GUILD-02, GUILD-03, GUILD-04, GUILD-05, GUILD-06, GUILD-07, ROLE-01, ROLE-02, ROLE-03, ROLE-04, ROLE-05, ROLE-06, ROLE-07

**Dependencies:** None (first phase)

**Plans:** 5 plans

**Status:** Complete (2026-01-18)

Plans:
- [x] 01-01-PLAN.md - Database schema (guilds, guild_members, RLS, functions)
- [x] 01-02-PLAN.md - Shared types for guild system
- [x] 01-03-PLAN.md - Game server handlers (create, join, leave, search)
- [x] 01-04-PLAN.md - Role management (promote, demote, kick, transfer, disband)
- [x] 01-05-PLAN.md - Frontend UI (guild panel, modals, member roster)

**Details:**
- Database: 2 tables (guilds, guild_members), 8 atomic functions
- Migration: 022_guilds.sql (590 lines)
- Patterns: SECURITY DEFINER functions, denormalized member_count, partial unique index for leader

---

### Phase 2: Guild Invites

**Goal:** Guild leaders and officers can recruit players through an invite system.

**Requirements:** INVITE-01, INVITE-02, INVITE-03, INVITE-04, INVITE-05

**Dependencies:** Phase 1 (requires guilds and roles to exist)

**Plans:** 3 plans

**Status:** Complete (2026-01-18)

Plans:
- [x] 02-01-PLAN.md - Database migration (guild_invites table, RLS, functions)
- [x] 02-02-PLAN.md - Shared types for invite system
- [x] 02-03-PLAN.md - Game server handlers (send, accept, decline, list invites)

**Details:**
- Database: 1 table (guild_invites), 5 functions
- Migration: 023_guild_invites.sql (~300 lines)
- Features: 7-day expiration, open/invite-only/closed modes

---

### Phase 3: Guild Chat

**Goal:** Guild members can communicate privately in a dedicated chat channel.

**Requirements:** CHAT-01, CHAT-02, CHAT-03

**Dependencies:** Phase 1 (requires guild membership)

**Plans:** 3 plans

**Status:** Complete (2026-01-18)

Plans:
- [x] 03-01-PLAN.md - Database migration (guild_messages table, RLS)
- [x] 03-02-PLAN.md - Game server handlers (send message, get history, broadcast)
- [x] 03-03-PLAN.md - Frontend integration (enable guild channel, role badges, history loading)

**Details:**
- Database: 1 table (guild_messages), 3 functions
- Migration: 025_guild_messages.sql (~150 lines)
- Critical fix: Changed broadcast() to broadcastToGuild() for privacy

---

### Phase 4: Guild Bank

**Goal:** Guilds have shared storage for currency, items, and Pokemon with role-based access and full audit logging.

**Requirements:** BANK-01 through BANK-15, LOG-01, LOG-02, LOG-03

**Dependencies:** Phase 1 (requires guilds and roles)

**Plans:** 5 plans

**Status:** Complete (2026-01-18)

Plans:
- [x] 04-01-PLAN.md - Database schema (bank tables, permissions, limits, logs, SECURITY DEFINER functions)
- [x] 04-02-PLAN.md - Shared types for bank system
- [x] 04-03-PLAN.md - Game server handlers (deposit, withdraw, requests, logs, permissions)
- [x] 04-04-PLAN.md - Frontend UI: Bank modal, Currency tab, Items tab
- [x] 04-05-PLAN.md - Frontend UI: Pokemon tab, Logs tab, Requests tab

**Details:**
- Database: 10 tables, 22 functions
- Migration: 026_guild_bank.sql (2008 lines)
- Features: Daily limits, request system, BST-based Pokemon point costs, slot expansion

---

### Phase 5: Guild Quests

**Goal:** Guilds have shared daily and weekly goals that all members contribute to for rewards.

**Requirements:** QUEST-01, QUEST-02, QUEST-03, QUEST-04, QUEST-05, QUEST-06

**Dependencies:** Phase 4 (quests reward guild bank)

**Plans:** 6 plans

**Status:** Complete (2026-01-19)

Plans:
- [x] 05-01-PLAN.md - Database schema (quest tables, SECURITY DEFINER functions)
- [x] 05-02-PLAN.md - Shared types for quest system
- [x] 05-03-PLAN.md - Game server activity hooks (catches, battles, evolutions update progress)
- [x] 05-04-PLAN.md - Game server handlers (fetch quests, reroll, history)
- [x] 05-05-PLAN.md - Frontend state (Zustand store, WebSocket handlers)
- [x] 05-06-PLAN.md - Frontend UI (GuildQuestsModal, QuestCard, history, confetti)

**Details:**
- Database: 5 tables, 14 functions
- Migration: 027_guild_quests.sql (1370 lines)
- Features: Lazy generation, advisory locks, activity tracking, milestone notifications, contribution leaderboards

---

### Phase 6: Guild Shop & Statistics

**Goal:** Guilds can spend accumulated resources on group buffs and compare themselves on leaderboards.

**Requirements:** SHOP-01 through SHOP-06, STATS-01 through STATS-06

**Dependencies:** Phase 4 (shop requires guild bank currency/points), Phase 5 (quests earn guild points)

**Plans:** 4 plans

**Status:** Complete (2026-01-19)

Plans:
- [x] 06-01-PLAN.md - Database schema (buff tables, shop functions, statistics, leaderboard)
- [x] 06-02-PLAN.md - Shared types for shop and statistics
- [x] 06-03-PLAN.md - Game server handlers (purchase, buff application in tick, statistics, leaderboard)
- [x] 06-04-PLAN.md - Frontend UI (shop modal, active buffs, statistics section, leaderboard modal)

**Details:**
- Database: 2 tables, 6 functions
- Migration: 028_guild_shop.sql (549 lines)
- Features: 5-second buff cache, buff multipliers in tick processing, system messages

---

### Phase 7: Zone Content

**Goal:** Game world expands with Cerulean City, Misty's Gym, and Routes 24-25.

**Requirements:** ZONE-01, ZONE-02, ZONE-03, ZONE-04, ZONE-05

**Dependencies:** None (independent of guild features)

**Plans:** 1 plan

**Status:** Complete (2026-01-19)

Plans:
- [x] 07-01-PLAN.md - SQL migration (zones, connections, encounters, Misty's Gym)

**Details:**
- Database: 3 zones, 1 gym leader, 12 encounter table entries
- Migration: 030_cerulean_city.sql (146 lines)
- Features: Misty requires Boulder Badge, Abra as rare spawn (10%)

---

## Milestone Summary

**Key Decisions:**

- WoW-style role permissions (Leader > Officer > Member) for familiar, scalable hierarchy
- SECURITY DEFINER functions for all bank mutations with FOR UPDATE locking
- 5-second buff cache TTL balancing freshness with performance
- Fire-and-forget quest progress updates to not block tick loop
- Dedicated guild_messages table for better RLS isolation
- BST-based Pokemon point costs (1/2/5/10/25 by stat total)

**Issues Resolved:**

- Guild chat privacy (changed broadcast() to broadcastToGuild())
- Type mismatches in Pokemon display (species?.name fallback chain)
- Missing prerequisite components discovered during execution

**Technical Debt Incurred:**

None identified — all implementations are fully functional with no TODOs or stubs.

---

_For current project status, see .planning/PROJECT.md_
