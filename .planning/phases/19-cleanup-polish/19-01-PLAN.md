---
phase: 19-cleanup-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/game/MockGameScreen.tsx
  - apps/web/src/app/theme-compare/page.tsx
  - apps/web/src/components/game/EvolutionModal.tsx
  - apps/web/src/components/game/GymBattlePanel.tsx
  - apps/web/src/hooks/useBattleAnimation.ts
  - apps/web/src/components/game/BoxPanel.tsx
  - apps/web/src/components/game/GameShell.tsx
  - apps/web/src/components/game/IVGradeBadge.tsx
  - apps/web/src/components/game/LeaderboardPanel.tsx
  - apps/web/src/components/game/PartyPanel.tsx
  - apps/web/src/lib/ws/gameSocket.ts
  - apps/web/src/lib/sprites/placeholderSprites.ts
  - apps/web/src/lib/sprites/spriteAnimation.ts
  - apps/web/src/lib/sprites/spriteCatalog.ts
autonomous: true

must_haves:
  truths:
    - "MockGameScreen component no longer exists in codebase"
    - "/theme-compare route no longer exists"
    - "ESLint passes with zero errors (warnings acceptable)"
    - "npm run build completes successfully"
    - "BeveledButton component still used in production components"
  artifacts:
    - path: "apps/web/src/components/game/EvolutionModal.tsx"
      provides: "Fixed sparkle animation without Math.random in render"
    - path: "apps/web/src/hooks/useBattleAnimation.ts"
      provides: "Battle animation hook without setState in useEffect errors"
    - path: "apps/web/src/components/game/GymBattlePanel.tsx"
      provides: "Gym battle panel without setState in useEffect errors"
  key_links:
    - from: "apps/web/src/app/theme-compare/page.tsx"
      to: "DELETED"
      via: "File removal"
    - from: "apps/web/src/components/game/MockGameScreen.tsx"
      to: "DELETED"
      via: "File removal"
    - from: "apps/web/src/components/ui/BeveledButton.tsx"
      to: "Production components"
      via: "Import statements"
      pattern: "BeveledButton"
---

<objective>
Remove experimental code and fix all ESLint errors to create a clean, production-ready codebase.

Purpose: Phase 18 complete - the Modern theme is fully applied. MockGameScreen and /theme-compare served their purpose as a design reference and are now obsolete. Lint errors (37) indicate code quality issues that must be fixed before shipping v1.2.

Output: Clean codebase with zero ESLint errors, experimental files removed, and successful build.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/19-cleanup-polish/19-CONTEXT.md
@.planning/phases/19-cleanup-polish/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove experimental code</name>
  <files>
    - apps/web/src/components/game/MockGameScreen.tsx (DELETE)
    - apps/web/src/app/theme-compare/page.tsx (DELETE)
  </files>
  <action>
Delete the following files:
1. `apps/web/src/components/game/MockGameScreen.tsx` - 729-line static mock used for theme comparison
2. `apps/web/src/app/theme-compare/page.tsx` - Route that displays MockGameScreen

After deletion:
- Search for any imports of MockGameScreen (should be only in theme-compare/page.tsx)
- If any other files import MockGameScreen, remove those imports
- The .next/server/app/theme-compare/ build artifacts will be auto-cleaned on next build

Do NOT delete:
- BeveledButton component (used in production)
- Any shared utilities used by other components
  </action>
  <verify>
- `git status` shows both files deleted
- `grep -r "MockGameScreen" apps/web/src/` returns no results
- `grep -r "theme-compare" apps/web/src/` returns no results (except possibly Next.js config if route was referenced)
- `grep -r "BeveledButton" apps/web/src/components/game/ apps/web/src/components/ui/` returns at least 1 production usage (excluding MockGameScreen)
  </verify>
  <done>MockGameScreen.tsx and theme-compare/page.tsx deleted with no orphaned references, BeveledButton confirmed still used in production</done>
</task>

<task type="auto">
  <name>Task 2a: Fix EvolutionModal purity errors (3 errors)</name>
  <files>
    - apps/web/src/components/game/EvolutionModal.tsx
  </files>
  <action>
Fix `react-hooks/purity` errors in EvolutionModal.tsx.

**Error locations:**
- Line 27: Math.random in useMemo (left position)
- Line 28: Math.random in useMemo (top position)
- Line 30: Math.random in useMemo (animationDuration)

**Fix:** Replace the impure sparklePositions useMemo with useState initialization:
```typescript
// Create a seeded random function for deterministic sparkle positions
function seededRandom(seed: number): number {
  const x = Math.sin(seed * 9999) * 10000
  return x - Math.floor(x)
}

// Inside component:
const [sparklePositions] = useState(() =>
  [...Array(20)].map((_, i) => ({
    left: `${15 + seededRandom(i) * 70}%`,
    top: `${15 + seededRandom(i + 100) * 70}%`,
    animationDelay: `${i * 0.15}s`,
    animationDuration: `${1 + seededRandom(i + 200) * 0.5}s`
  }))
)
```
This generates deterministic but random-looking positions based on index.

Also fix the exhaustive-deps warnings on lines 31 and 40 while in this file.
  </action>
  <verify>
`npm run lint -- --ignore-pattern "public/storybook/**" apps/web/src/components/game/EvolutionModal.tsx 2>&1 | grep -c "error"` returns 0
  </verify>
  <done>EvolutionModal.tsx has 0 lint errors - sparkle positions use seeded random via useState</done>
</task>

<task type="auto">
  <name>Task 2b: Fix GymBattlePanel and useBattleAnimation state errors (6+ errors)</name>
  <files>
    - apps/web/src/components/game/GymBattlePanel.tsx
    - apps/web/src/hooks/useBattleAnimation.ts
  </files>
  <action>
Fix `react-hooks/set-state-in-effect` errors in both files.

**GymBattlePanel.tsx error locations:**
- Line 138: setBattlePhase('intro') in useEffect
- Line 193: setBattlePhase('result') in useEffect
- Line 316: setState in useEffect

**Fix for GymBattlePanel:** The issue is calling setBattlePhase/setBattleResult synchronously in useEffect. Refactor to use initialization pattern:
```typescript
// Track if we've initialized for current gym session
const initializedRef = useRef(false)

useEffect(() => {
  if (isGymOpen && currentGymLeader && !initializedRef.current) {
    initializedRef.current = true
    // Initialize state once
    setBattlePhase('intro')
    setBattleResult(null)
    // etc.
  }
  if (!isGymOpen) {
    initializedRef.current = false
  }
}, [isGymOpen, currentGymLeader])
```

**useBattleAnimation.ts error locations:**
- Multiple setState calls within useEffect bodies

**Fix for useBattleAnimation:** Convert to useReducer for atomic state updates:
```typescript
type BattleAnimationAction =
  | { type: 'START_BATTLE'; battle: ActiveBattle }
  | { type: 'ADVANCE_TURN'; turn: BattleTurn }
  | { type: 'START_CATCH' }
  | { type: 'SHOW_SUMMARY'; summary: BattleSummary }

function battleAnimationReducer(state: BattleAnimationState, action: BattleAnimationAction) {
  // Handle all state transitions in reducer
}
```
This consolidates all state changes into reducer, called from effects via dispatch().
  </action>
  <verify>
`npm run lint -- --ignore-pattern "public/storybook/**" apps/web/src/components/game/GymBattlePanel.tsx apps/web/src/hooks/useBattleAnimation.ts 2>&1 | grep -c "error"` returns 0
  </verify>
  <done>GymBattlePanel.tsx and useBattleAnimation.ts have 0 lint errors - state management uses refs/reducers</done>
</task>

<task type="auto">
  <name>Task 3: Fix high-priority unused variable warnings</name>
  <files>
    - apps/web/src/components/game/BoxPanel.tsx
    - apps/web/src/components/game/GameShell.tsx
    - apps/web/src/components/game/IVGradeBadge.tsx
    - apps/web/src/components/game/LeaderboardPanel.tsx
    - apps/web/src/components/game/PartyPanel.tsx
    - apps/web/src/lib/ws/gameSocket.ts
    - apps/web/src/lib/sprites/placeholderSprites.ts
    - apps/web/src/lib/sprites/spriteAnimation.ts
    - apps/web/src/lib/sprites/spriteCatalog.ts
    - apps/web/src/types/react-responsive-spritesheet.d.ts
  </files>
  <action>
Fix unused variable warnings in these high-priority files. Note: This addresses ~30 of 86 total warnings - remaining low-priority warnings (no-img-element, etc.) are acceptable.

**gameSocket.ts (highest priority - 20+ warnings):**
Remove unused type imports:
- PendingEvolution, TradeStatus, Guild, GuildMember, GuildRole, GuildPreview
- GuildOutgoingInvite, GuildBank, GuildBankItemUpdatedPayload, GuildBankPokemonAddedPayload
- GuildBankSlotsExpandedPayload, GuildBankRequest, BankCategory, GuildLeaderboardMetric
- CHAT_CHANNELS

For unused function parameters, prefix with underscore:
- `_payload` for handlers that don't use payload

**BoxPanel.tsx:**
Remove unused imports: getIVGrade, IVStats, IVGrade

**GameShell.tsx:**
Remove or use `outgoingTradeRequests` assignment

**IVGradeBadge.tsx:**
Remove unused `description` destructuring

**LeaderboardPanel.tsx:**
Remove unused `LeaderboardTimeframe` import

**PartyPanel.tsx:**
Remove unused `filled` destructuring

**Sprite files:**
- placeholderSprites.ts: Remove DIRECTION_ROW, unused cy
- spriteAnimation.ts: Remove unused row, direction
- spriteCatalog.ts: Remove SpriteSheetMeta

**react-responsive-spritesheet.d.ts:**
Remove unused RefObject import
  </action>
  <verify>
Run `npm run lint -- --ignore-pattern "public/storybook/**" 2>&1 | grep "@typescript-eslint/no-unused-vars" | wc -l` - should be significantly reduced from initial count (some remaining warnings in other files acceptable)
  </verify>
  <done>High-priority unused variable warnings fixed - imports cleaned up, unused parameters prefixed with underscore. Remaining warnings are low-priority (no-img-element for sprites)</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run lint -- --ignore-pattern "public/storybook/**"` shows 0 errors
2. `npm run build` completes successfully
3. No TypeScript compilation errors
4. Git shows clean diff of targeted files
5. `grep -r "BeveledButton" apps/web/src/` shows production usage
</verification>

<success_criteria>
- MockGameScreen.tsx deleted
- /theme-compare route deleted
- BeveledButton confirmed still used in production
- ESLint: 0 errors (warnings for img elements acceptable)
- Build: Passes without errors
- No orphaned imports or dead code from experimental removal
</success_criteria>

<output>
After completion, create `.planning/phases/19-cleanup-polish/19-01-SUMMARY.md`
</output>
