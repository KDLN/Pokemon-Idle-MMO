---
phase: 08-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/stores/gameStore.ts
  - apps/web/src/components/game/guild/BankPokemonTab.tsx
autonomous: true

must_haves:
  truths:
    - "User toggles between grid/list/card view in Guild Bank Pokemon tab and display switches correctly"
    - "View preference persists across page navigation"
    - "View preference persists across browser refresh"
  artifacts:
    - path: "apps/web/src/stores/gameStore.ts"
      provides: "Persisted guildBankViewMode state"
      contains: "guildBankViewMode"
    - path: "apps/web/src/components/game/guild/BankPokemonTab.tsx"
      provides: "Uses Zustand store for viewMode"
      contains: "useGameStore.*guildBankViewMode"
  key_links:
    - from: "apps/web/src/components/game/guild/BankPokemonTab.tsx"
      to: "apps/web/src/stores/gameStore.ts"
      via: "useGameStore hook for viewMode"
      pattern: "useGameStore.*guildBankViewMode"
---

<objective>
Fix the Guild Bank view toggle to properly switch display modes and persist the preference across navigation/refresh.

Purpose: The BankPokemonTab component has a view toggle (grid/list/card) but uses local React state which:
1. May have issues with state updates (need to verify)
2. Does NOT persist across page navigation or browser refresh

Output: Working view toggle with persistence via Zustand store.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Relevant existing code
@apps/web/src/stores/gameStore.ts (Zustand store with persist middleware)
@apps/web/src/components/game/guild/BankPokemonTab.tsx (current implementation using local state)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add guildBankViewMode to Zustand store with persistence</name>
  <files>apps/web/src/stores/gameStore.ts</files>
  <action>
Add view mode state to the Zustand store. The store already uses persist middleware, so new state will automatically persist.

1. Add the type near the top with other types:
```typescript
type GuildBankViewMode = 'grid' | 'list' | 'card'
```

2. Add to the GameStore interface (around line 370, in the guild bank state section):
```typescript
// Guild bank view preference
guildBankViewMode: GuildBankViewMode
setGuildBankViewMode: (mode: GuildBankViewMode) => void
```

3. Add to initialState (around line 490, in guild bank state section):
```typescript
guildBankViewMode: 'grid' as GuildBankViewMode,
```

4. Add the setter implementation (around line 1190, near other guild bank methods):
```typescript
setGuildBankViewMode: (mode) => set({ guildBankViewMode: mode }),
```

Note: The Zustand store already uses persist middleware (see line ~504: `persist(...)`) so this will automatically be saved to localStorage.
  </action>
  <verify>
1. TypeScript compiles: `cd apps/web && npx tsc --noEmit` (no errors related to guildBankViewMode)
2. State exists: `grep -c "guildBankViewMode" apps/web/src/stores/gameStore.ts` returns 4+ (type, interface, initial, setter)
  </verify>
  <done>gameStore has guildBankViewMode state with getter and setter, automatically persisted via existing persist middleware</done>
</task>

<task type="auto">
  <name>Task 2: Update BankPokemonTab to use Zustand store for viewMode</name>
  <files>apps/web/src/components/game/guild/BankPokemonTab.tsx</files>
  <action>
Update BankPokemonTab.tsx to use the Zustand store instead of local React state:

1. Remove the local state (line ~42):
```typescript
// REMOVE: const [viewMode, setViewMode] = useState<ViewMode>('grid')
```

2. Get state from store (add to existing useGameStore calls around line 47-50):
```typescript
const viewMode = useGameStore((state) => state.guildBankViewMode)
const setViewMode = useGameStore((state) => state.setGuildBankViewMode)
```

3. Remove the local ViewMode type definition (line ~8) since it's now in the store:
```typescript
// REMOVE: type ViewMode = 'grid' | 'list' | 'card'
```

4. Import the type from store if needed, OR just use the store's type directly (ViewMode is inferred from the store).

The rest of the component (toggle buttons, conditional rendering) stays the same - they already use `viewMode` and `setViewMode` which will now come from the store.
  </action>
  <verify>
1. TypeScript compiles: `cd apps/web && npx tsc --noEmit`
2. Local state removed: `grep -c "useState.*ViewMode" apps/web/src/components/game/guild/BankPokemonTab.tsx` returns 0
3. Store used: `grep -c "guildBankViewMode" apps/web/src/components/game/guild/BankPokemonTab.tsx` returns 2+ (getter and setter)
  </verify>
  <done>BankPokemonTab uses Zustand store for viewMode, removing local state and enabling persistence</done>
</task>

</tasks>

<verification>
Manual testing flow:
1. Open game and navigate to Guild Bank > Pokemon tab
2. Default view should be "grid" (first time) or last selected view (returning user)
3. Click "list" toggle - display switches to list view
4. Click "card" toggle - display switches to card view
5. Navigate away from Guild Bank (close modal)
6. Re-open Guild Bank > Pokemon tab
7. View should still be "card" (persisted)
8. Refresh the browser
9. Re-open Guild Bank > Pokemon tab
10. View should still be "card" (persisted to localStorage)
</verification>

<success_criteria>
1. View toggle buttons switch display mode correctly (grid/list/card)
2. Selected view persists when closing and reopening Guild Bank modal
3. Selected view persists across browser refresh
4. No TypeScript errors
5. No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-bug-fixes/08-02-SUMMARY.md`
</output>
