---
phase: 06-guild-shop-statistics
plan: 04
type: execute
wave: 3
depends_on: ["06-03"]
files_modified:
  - apps/web/src/stores/gameStore.ts
  - apps/web/src/lib/ws/gameSocket.ts
  - apps/web/src/components/game/guild/GuildShopModal.tsx
  - apps/web/src/components/game/guild/ShopBuffCard.tsx
  - apps/web/src/components/game/guild/ActiveBuffsDisplay.tsx
  - apps/web/src/components/game/guild/GuildStatisticsSection.tsx
  - apps/web/src/components/game/guild/GuildLeaderboardModal.tsx
  - apps/web/src/components/game/guild/index.ts
  - apps/web/src/components/game/guild/GuildPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Guild shop modal displays 3 buff options"
    - "Players can purchase buffs with currency or guild points"
    - "Active buffs visible with countdown timer"
    - "Guild statistics displayed in panel"
    - "Leaderboard modal shows top 50 guilds"
    - "Leaderboard metric can be changed (catches/pokedex/members)"
  artifacts:
    - path: "apps/web/src/components/game/guild/GuildShopModal.tsx"
      provides: "Shop interface for purchasing buffs"
      min_lines: 100
    - path: "apps/web/src/components/game/guild/ActiveBuffsDisplay.tsx"
      provides: "Active buffs with countdown timers"
      min_lines: 50
    - path: "apps/web/src/components/game/guild/GuildStatisticsSection.tsx"
      provides: "Statistics display section"
      min_lines: 40
    - path: "apps/web/src/components/game/guild/GuildLeaderboardModal.tsx"
      provides: "Top 50 guild leaderboard"
      min_lines: 100
  key_links:
    - from: "apps/web/src/components/game/guild/GuildShopModal.tsx"
      to: "apps/web/src/lib/ws/gameSocket.ts"
      via: "sendPurchaseGuildBuff method"
      pattern: "sendPurchaseGuildBuff"
    - from: "apps/web/src/stores/gameStore.ts"
      to: "ActiveGuildBuffs type"
      via: "guildActiveBuffs state property"
      pattern: "guildActiveBuffs"
---

<objective>
Create frontend UI for guild shop, active buff display, statistics section, and leaderboard modal.

Purpose: Enable players to purchase buffs, see active buff timers, view guild statistics, and compare guilds on the leaderboard.

Output: GuildShopModal, ShopBuffCard, ActiveBuffsDisplay, GuildStatisticsSection, GuildLeaderboardModal components with Zustand state and WebSocket integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-guild-shop-statistics/06-RESEARCH.md
@.planning/phases/06-guild-shop-statistics/06-03-SUMMARY.md
@apps/web/src/stores/gameStore.ts
@apps/web/src/lib/ws/gameSocket.ts
@apps/web/src/components/game/guild/GuildPanel.tsx
@apps/web/src/components/game/guild/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add guild shop state to Zustand and WebSocket handlers</name>
  <files>apps/web/src/stores/gameStore.ts, apps/web/src/lib/ws/gameSocket.ts</files>
  <action>
1. **In gameStore.ts**, add state for shop and statistics after guild quest state:

```typescript
// Guild shop/statistics state
guildActiveBuffs: ActiveGuildBuffs | null
guildStatistics: GuildStatistics | null
guildLeaderboard: {
  metric: LeaderboardMetric
  entries: GuildLeaderboardEntry[]
  myGuildRank: GuildRankInfo | null
} | null
```

Add actions:
```typescript
setGuildActiveBuffs: (buffs: ActiveGuildBuffs | null) => void
updateGuildBuff: (buff: GuildBuff) => void
clearExpiredBuff: (buffType: GuildBuffType) => void
setGuildStatistics: (statistics: GuildStatistics | null) => void
setGuildLeaderboard: (leaderboard: { metric: LeaderboardMetric; entries: GuildLeaderboardEntry[]; myGuildRank: GuildRankInfo | null } | null) => void
```

Add implementations:
```typescript
setGuildActiveBuffs: (buffs) => set({ guildActiveBuffs: buffs }),
updateGuildBuff: (buff) => set((state) => ({
  guildActiveBuffs: state.guildActiveBuffs
    ? { ...state.guildActiveBuffs, [buff.buff_type]: buff }
    : { xp_bonus: null, catch_rate: null, encounter_rate: null, [buff.buff_type]: buff }
})),
clearExpiredBuff: (buffType) => set((state) => ({
  guildActiveBuffs: state.guildActiveBuffs
    ? { ...state.guildActiveBuffs, [buffType]: null }
    : null
})),
setGuildStatistics: (statistics) => set({ guildStatistics: statistics }),
setGuildLeaderboard: (leaderboard) => set({ guildLeaderboard: leaderboard }),
```

Initialize in initial state:
```typescript
guildActiveBuffs: null,
guildStatistics: null,
guildLeaderboard: null,
```

2. **In gameSocket.ts**, add WebSocket message handlers:

```typescript
// In setupMessageHandlers, add cases:
case 'guild_active_buffs':
  useGameStore.getState().setGuildActiveBuffs(payload.buffs)
  break

case 'guild_buff_purchased':
  useGameStore.getState().updateGuildBuff(payload.buff)
  // Show toast notification
  toast.success(`${payload.purchased_by_username} activated ${payload.buff.buff_type.replace('_', ' ')}!`)
  break

case 'guild_buff_expired':
  useGameStore.getState().clearExpiredBuff(payload.buff_type)
  toast.info(`${payload.buff_type.replace('_', ' ')} buff has expired`)
  break

case 'guild_statistics':
  useGameStore.getState().setGuildStatistics(payload.statistics)
  break

case 'guild_leaderboard':
  useGameStore.getState().setGuildLeaderboard({
    metric: payload.metric,
    entries: payload.entries,
    myGuildRank: payload.my_guild_rank
  })
  break
```

Add send methods:
```typescript
sendPurchaseGuildBuff(buffType: string, durationHours: number, useGuildPoints: boolean = false) {
  this.send('purchase_guild_buff', { buff_type: buffType, duration_hours: durationHours, use_guild_points: useGuildPoints })
}

sendGetActiveBuffs() {
  this.send('get_active_buffs', {})
}

sendGetGuildStatistics() {
  this.send('get_guild_statistics', {})
}

sendGetGuildLeaderboard(metric: string, limit: number = 50) {
  this.send('get_guild_leaderboard', { metric, limit })
}
```
  </action>
  <verify>
Run: `grep -c "guildActiveBuffs\|guildStatistics\|guildLeaderboard" apps/web/src/stores/gameStore.ts` shows at least 6 matches.
Run: `grep -c "sendPurchaseGuildBuff\|sendGetGuildLeaderboard" apps/web/src/lib/ws/gameSocket.ts` shows at least 2 matches.
  </verify>
  <done>
Zustand state added: guildActiveBuffs, guildStatistics, guildLeaderboard with setters. WebSocket handlers for buff_purchased, buff_expired, statistics, leaderboard. Send methods for purchasing buffs and fetching data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GuildShopModal and ShopBuffCard components</name>
  <files>apps/web/src/components/game/guild/GuildShopModal.tsx, apps/web/src/components/game/guild/ShopBuffCard.tsx</files>
  <action>
1. **Create ShopBuffCard.tsx:**

```tsx
'use client'

import { useState } from 'react'
import { useGameStore } from '@/stores/gameStore'
import { gameSocket } from '@/lib/ws/gameSocket'
import type { GuildBuffType, GuildBuff } from '@pokemon-idle/shared'

interface ShopBuffCardProps {
  buffType: GuildBuffType
  name: string
  description: string
  costCurrencyPerHour: number
  costGuildPointsPerHour: number
  activeBuff: GuildBuff | null
  bankBalance: number
  guildPoints: number
  canPurchase: boolean  // Based on role
}

export function ShopBuffCard({
  buffType,
  name,
  description,
  costCurrencyPerHour,
  costGuildPointsPerHour,
  activeBuff,
  bankBalance,
  guildPoints,
  canPurchase
}: ShopBuffCardProps) {
  const [duration, setDuration] = useState(1)
  const [usePoints, setUsePoints] = useState(false)
  const [isPurchasing, setIsPurchasing] = useState(false)

  const totalCostCurrency = costCurrencyPerHour * duration
  const totalCostPoints = costGuildPointsPerHour * duration
  const canAffordCurrency = bankBalance >= totalCostCurrency
  const canAffordPoints = guildPoints >= totalCostPoints

  const handlePurchase = async () => {
    if (!canPurchase) return
    if (usePoints && !canAffordPoints) return
    if (!usePoints && !canAffordCurrency) return

    setIsPurchasing(true)
    gameSocket.sendPurchaseGuildBuff(buffType, duration, usePoints)
    // Reset after brief delay to allow for response
    setTimeout(() => setIsPurchasing(false), 1000)
  }

  // Calculate remaining time if buff is active
  const remainingMs = activeBuff
    ? new Date(activeBuff.ends_at).getTime() - Date.now()
    : 0
  const remainingHours = Math.max(0, Math.floor(remainingMs / (1000 * 60 * 60)))
  const remainingMinutes = Math.max(0, Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60)))

  return (
    <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
      <div className="flex justify-between items-start mb-2">
        <h4 className="text-lg font-semibold text-white">{name}</h4>
        <span className="text-green-400 text-sm">+10%</span>
      </div>

      <p className="text-gray-400 text-sm mb-3">{description}</p>

      {activeBuff && remainingMs > 0 && (
        <div className="bg-green-900/30 border border-green-700 rounded p-2 mb-3">
          <span className="text-green-400 text-sm">
            Active: {remainingHours}h {remainingMinutes}m remaining
          </span>
        </div>
      )}

      <div className="space-y-2 mb-3">
        <label className="text-gray-300 text-sm">Duration (hours)</label>
        <input
          type="range"
          min="1"
          max="24"
          value={duration}
          onChange={(e) => setDuration(parseInt(e.target.value))}
          className="w-full"
        />
        <div className="flex justify-between text-sm text-gray-400">
          <span>1h</span>
          <span className="text-white font-medium">{duration}h</span>
          <span>24h</span>
        </div>
      </div>

      <div className="flex gap-2 mb-3">
        <button
          onClick={() => setUsePoints(false)}
          className={`flex-1 py-2 px-3 rounded text-sm ${
            !usePoints
              ? 'bg-yellow-600 text-white'
              : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
          }`}
        >
          Currency ({totalCostCurrency.toLocaleString()})
        </button>
        <button
          onClick={() => setUsePoints(true)}
          className={`flex-1 py-2 px-3 rounded text-sm ${
            usePoints
              ? 'bg-purple-600 text-white'
              : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
          }`}
        >
          Points ({totalCostPoints.toLocaleString()})
        </button>
      </div>

      <button
        onClick={handlePurchase}
        disabled={!canPurchase || isPurchasing || (usePoints ? !canAffordPoints : !canAffordCurrency)}
        className={`w-full py-2 rounded font-medium ${
          canPurchase && (usePoints ? canAffordPoints : canAffordCurrency)
            ? 'bg-blue-600 hover:bg-blue-700 text-white'
            : 'bg-gray-600 text-gray-400 cursor-not-allowed'
        }`}
      >
        {isPurchasing ? 'Purchasing...' : activeBuff ? 'Extend Buff' : 'Purchase'}
      </button>

      {!canPurchase && (
        <p className="text-red-400 text-xs mt-2 text-center">
          Only Leaders and Officers can purchase buffs
        </p>
      )}
    </div>
  )
}
```

2. **Create GuildShopModal.tsx:**

```tsx
'use client'

import { useEffect } from 'react'
import { useGameStore } from '@/stores/gameStore'
import { gameSocket } from '@/lib/ws/gameSocket'
import { ShopBuffCard } from './ShopBuffCard'

interface GuildShopModalProps {
  isOpen: boolean
  onClose: () => void
}

const SHOP_ITEMS = [
  {
    buffType: 'xp_bonus' as const,
    name: 'XP Boost',
    description: 'All guild members earn 10% more XP from battles',
    costCurrencyPerHour: 1000,
    costGuildPointsPerHour: 200
  },
  {
    buffType: 'catch_rate' as const,
    name: 'Catch Rate Boost',
    description: 'All guild members have 10% higher catch rate',
    costCurrencyPerHour: 1000,
    costGuildPointsPerHour: 200
  },
  {
    buffType: 'encounter_rate' as const,
    name: 'Encounter Rate Boost',
    description: 'All guild members encounter Pokemon 10% more often',
    costCurrencyPerHour: 1000,
    costGuildPointsPerHour: 200
  }
]

export function GuildShopModal({ isOpen, onClose }: GuildShopModalProps) {
  const guild = useGameStore((state) => state.guild)
  const guildActiveBuffs = useGameStore((state) => state.guildActiveBuffs)
  const guildBank = useGameStore((state) => state.guildBank)
  const guildStatistics = useGameStore((state) => state.guildStatistics)

  const myRole = guild?.role
  const canPurchase = myRole === 'leader' || myRole === 'officer'
  const bankBalance = guildBank?.currency?.balance || 0
  const guildPoints = guildStatistics?.guild_points || 0

  useEffect(() => {
    if (isOpen && guild) {
      gameSocket.sendGetActiveBuffs()
      gameSocket.sendGetGuildStatistics()
    }
  }, [isOpen, guild])

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div className="bg-gray-900 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-bold text-white">Guild Shop</h2>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-white text-2xl"
          >
            &times;
          </button>
        </div>

        <div className="flex justify-between items-center mb-4 bg-gray-800 rounded p-3">
          <div>
            <span className="text-gray-400 text-sm">Bank Balance</span>
            <p className="text-yellow-400 font-bold">{bankBalance.toLocaleString()}</p>
          </div>
          <div>
            <span className="text-gray-400 text-sm">Guild Points</span>
            <p className="text-purple-400 font-bold">{guildPoints.toLocaleString()}</p>
          </div>
        </div>

        <div className="grid gap-4">
          {SHOP_ITEMS.map((item) => (
            <ShopBuffCard
              key={item.buffType}
              buffType={item.buffType}
              name={item.name}
              description={item.description}
              costCurrencyPerHour={item.costCurrencyPerHour}
              costGuildPointsPerHour={item.costGuildPointsPerHour}
              activeBuff={guildActiveBuffs?.[item.buffType] || null}
              bankBalance={bankBalance}
              guildPoints={guildPoints}
              canPurchase={canPurchase}
            />
          ))}
        </div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
File apps/web/src/components/game/guild/ShopBuffCard.tsx exists and contains duration slider and purchase button.
File apps/web/src/components/game/guild/GuildShopModal.tsx exists and renders 3 ShopBuffCard components.
  </verify>
  <done>
GuildShopModal displays 3 buff options with currency/points toggle. ShopBuffCard shows active buff time remaining, duration slider (1-24h), payment method toggle, and purchase button with role check.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create ActiveBuffsDisplay, GuildStatisticsSection, and GuildLeaderboardModal</name>
  <files>apps/web/src/components/game/guild/ActiveBuffsDisplay.tsx, apps/web/src/components/game/guild/GuildStatisticsSection.tsx, apps/web/src/components/game/guild/GuildLeaderboardModal.tsx, apps/web/src/components/game/guild/index.ts, apps/web/src/components/game/guild/GuildPanel.tsx</files>
  <action>
1. **Create ActiveBuffsDisplay.tsx:**

```tsx
'use client'

import { useEffect, useState } from 'react'
import { useGameStore } from '@/stores/gameStore'
import { gameSocket } from '@/lib/ws/gameSocket'

export function ActiveBuffsDisplay() {
  const guildActiveBuffs = useGameStore((state) => state.guildActiveBuffs)
  const guild = useGameStore((state) => state.guild)
  const [, setTick] = useState(0)

  // Refresh every minute to update timers
  useEffect(() => {
    const interval = setInterval(() => setTick((t) => t + 1), 60000)
    return () => clearInterval(interval)
  }, [])

  // Fetch active buffs on mount if in guild
  useEffect(() => {
    if (guild) {
      gameSocket.sendGetActiveBuffs()
    }
  }, [guild])

  if (!guild || !guildActiveBuffs) return null

  const activeBuffs = [
    { key: 'xp_bonus', name: 'XP +10%', buff: guildActiveBuffs.xp_bonus, color: 'blue' },
    { key: 'catch_rate', name: 'Catch +10%', buff: guildActiveBuffs.catch_rate, color: 'green' },
    { key: 'encounter_rate', name: 'Encounter +10%', buff: guildActiveBuffs.encounter_rate, color: 'purple' }
  ].filter((b) => b.buff && new Date(b.buff.ends_at).getTime() > Date.now())

  if (activeBuffs.length === 0) return null

  return (
    <div className="flex gap-2 flex-wrap">
      {activeBuffs.map(({ key, name, buff, color }) => {
        const remainingMs = new Date(buff!.ends_at).getTime() - Date.now()
        const hours = Math.floor(remainingMs / (1000 * 60 * 60))
        const minutes = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60))

        return (
          <div
            key={key}
            className={`px-2 py-1 rounded text-xs font-medium bg-${color}-900/50 border border-${color}-700 text-${color}-300`}
          >
            {name} ({hours}h {minutes}m)
          </div>
        )
      })}
    </div>
  )
}
```

2. **Create GuildStatisticsSection.tsx:**

```tsx
'use client'

import { useEffect } from 'react'
import { useGameStore } from '@/stores/gameStore'
import { gameSocket } from '@/lib/ws/gameSocket'

export function GuildStatisticsSection() {
  const guildStatistics = useGameStore((state) => state.guildStatistics)
  const guild = useGameStore((state) => state.guild)

  useEffect(() => {
    if (guild) {
      gameSocket.sendGetGuildStatistics()
    }
  }, [guild])

  if (!guildStatistics) return null

  const stats = [
    { label: 'Total Catches', value: guildStatistics.total_catches.toLocaleString() },
    { label: 'Unique Species', value: guildStatistics.unique_species.toString() },
    { label: 'Members', value: guildStatistics.member_count.toString() },
    { label: 'Avg Level', value: guildStatistics.avg_level.toFixed(1) },
    { label: 'Days Active', value: guildStatistics.days_active.toString() },
    { label: 'Guild Points', value: guildStatistics.guild_points.toLocaleString() }
  ]

  return (
    <div className="bg-gray-800 rounded-lg p-3">
      <h4 className="text-white font-semibold mb-2">Guild Statistics</h4>
      <div className="grid grid-cols-2 gap-2 text-sm">
        {stats.map((stat) => (
          <div key={stat.label} className="flex justify-between">
            <span className="text-gray-400">{stat.label}</span>
            <span className="text-white font-medium">{stat.value}</span>
          </div>
        ))}
      </div>
    </div>
  )
}
```

3. **Create GuildLeaderboardModal.tsx:**

```tsx
'use client'

import { useState, useEffect } from 'react'
import { useGameStore } from '@/stores/gameStore'
import { gameSocket } from '@/lib/ws/gameSocket'
import type { LeaderboardMetric } from '@pokemon-idle/shared'

interface GuildLeaderboardModalProps {
  isOpen: boolean
  onClose: () => void
}

const METRICS: { value: LeaderboardMetric; label: string }[] = [
  { value: 'catches', label: 'Total Catches' },
  { value: 'pokedex', label: 'Unique Species' },
  { value: 'members', label: 'Member Count' }
]

export function GuildLeaderboardModal({ isOpen, onClose }: GuildLeaderboardModalProps) {
  const [metric, setMetric] = useState<LeaderboardMetric>('catches')
  const guildLeaderboard = useGameStore((state) => state.guildLeaderboard)

  useEffect(() => {
    if (isOpen) {
      gameSocket.sendGetGuildLeaderboard(metric)
    }
  }, [isOpen, metric])

  if (!isOpen) return null

  const entries = guildLeaderboard?.entries || []
  const myRank = guildLeaderboard?.myGuildRank

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div className="bg-gray-900 rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-bold text-white">Guild Leaderboard</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">
            &times;
          </button>
        </div>

        <div className="flex gap-2 mb-4">
          {METRICS.map((m) => (
            <button
              key={m.value}
              onClick={() => setMetric(m.value)}
              className={`flex-1 py-2 px-3 rounded text-sm ${
                metric === m.value
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
              }`}
            >
              {m.label}
            </button>
          ))}
        </div>

        {myRank && (
          <div className="bg-blue-900/30 border border-blue-700 rounded p-3 mb-4">
            <span className="text-blue-300 text-sm">Your Guild</span>
            <div className="flex justify-between items-center">
              <span className="text-white font-semibold">{myRank.guild_name}</span>
              <span className="text-yellow-400">#{myRank.rank} ({myRank.value.toLocaleString()})</span>
            </div>
          </div>
        )}

        <div className="space-y-2">
          {entries.map((entry) => (
            <div
              key={entry.id}
              className={`flex items-center gap-3 p-2 rounded ${
                entry.rank <= 3 ? 'bg-gray-800' : 'bg-gray-800/50'
              }`}
            >
              <span className={`w-8 text-center font-bold ${
                entry.rank === 1 ? 'text-yellow-400' :
                entry.rank === 2 ? 'text-gray-300' :
                entry.rank === 3 ? 'text-amber-600' :
                'text-gray-500'
              }`}>
                #{entry.rank}
              </span>
              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <span className="text-white font-medium">{entry.name}</span>
                  <span className="text-gray-500 text-sm">[{entry.tag}]</span>
                </div>
                <span className="text-gray-400 text-xs">Leader: {entry.leader_name}</span>
              </div>
              <span className="text-green-400 font-semibold">{entry.value.toLocaleString()}</span>
            </div>
          ))}

          {entries.length === 0 && (
            <p className="text-gray-400 text-center py-4">No guilds found</p>
          )}
        </div>
      </div>
    </div>
  )
}
```

4. **Update index.ts to export new components:**

```typescript
// Add exports
export { GuildShopModal } from './GuildShopModal'
export { ShopBuffCard } from './ShopBuffCard'
export { ActiveBuffsDisplay } from './ActiveBuffsDisplay'
export { GuildStatisticsSection } from './GuildStatisticsSection'
export { GuildLeaderboardModal } from './GuildLeaderboardModal'
```

5. **Update GuildPanel.tsx to add Shop and Leaderboard buttons:**

In GuildPanel, add state for modals:
```tsx
const [isShopOpen, setIsShopOpen] = useState(false)
const [isLeaderboardOpen, setIsLeaderboardOpen] = useState(false)
```

Add buttons after existing buttons (Bank, Quests):
```tsx
<button
  onClick={() => setIsShopOpen(true)}
  className="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm"
>
  Shop
</button>
<button
  onClick={() => setIsLeaderboardOpen(true)}
  className="px-3 py-1 bg-cyan-600 hover:bg-cyan-700 text-white rounded text-sm"
>
  Leaderboard
</button>
```

Add ActiveBuffsDisplay component in guild info section:
```tsx
<ActiveBuffsDisplay />
```

Add GuildStatisticsSection component:
```tsx
<GuildStatisticsSection />
```

Add modal renders at end of component:
```tsx
<GuildShopModal isOpen={isShopOpen} onClose={() => setIsShopOpen(false)} />
<GuildLeaderboardModal isOpen={isLeaderboardOpen} onClose={() => setIsLeaderboardOpen(false)} />
```

Import the new components.
  </action>
  <verify>
Run: `ls apps/web/src/components/game/guild/` shows all new component files exist.
Run: `grep -c "GuildShopModal\|GuildLeaderboardModal\|ActiveBuffsDisplay\|GuildStatisticsSection" apps/web/src/components/game/guild/GuildPanel.tsx` shows at least 4 imports/usages.
  </verify>
  <done>
ActiveBuffsDisplay shows active buffs with countdown. GuildStatisticsSection shows 6 stats. GuildLeaderboardModal shows top 50 with metric toggle and player's guild rank. GuildPanel has Shop and Leaderboard buttons. All components exported from index.ts.
  </done>
</task>

</tasks>

<verification>
1. All 5 new component files exist in guild/ directory
2. GuildShopModal renders 3 ShopBuffCard components
3. ShopBuffCard has duration slider (1-24h), currency/points toggle, purchase button
4. ActiveBuffsDisplay shows active buffs with remaining time
5. GuildStatisticsSection shows all 6 stats
6. GuildLeaderboardModal has metric toggle and shows top 50
7. GuildPanel has Shop and Leaderboard buttons
8. index.ts exports all new components
9. Frontend builds without errors: `cd apps/web && npm run build`
</verification>

<success_criteria>
- Guild shop modal displays 3 buff options
- Buff purchase with duration slider works
- Currency/guild points payment toggle works
- Active buffs display with countdown timer
- Guild statistics displayed in panel
- Leaderboard shows top 50 guilds
- Leaderboard metric can be switched
- Player's guild rank shown on leaderboard
- Only Leader/Officer can purchase buffs (UI enforced)
</success_criteria>

<output>
After completion, create `.planning/phases/06-guild-shop-statistics/06-04-SUMMARY.md`
</output>
