---
phase: 06-guild-shop-statistics
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/types/guild.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript types exist for guild buffs"
    - "TypeScript types exist for guild statistics"
    - "TypeScript types exist for leaderboard entries"
    - "WebSocket payload types defined for shop and stats operations"
  artifacts:
    - path: "packages/shared/src/types/guild.ts"
      provides: "GuildBuff, GuildBuffType, GuildStatistics, LeaderboardEntry types and payloads"
      exports: ["GuildBuff", "GuildBuffType", "GuildStatistics", "GuildLeaderboardEntry"]
  key_links:
    - from: "packages/shared/src/types/guild.ts"
      to: "apps/game-server/src/types.ts"
      via: "re-export from shared types"
      pattern: "export.*from.*guild"
---

<objective>
Add TypeScript types for guild shop buffs, statistics, and leaderboard to the shared types package.

Purpose: Enable type-safe communication between game server and web client for buff purchases, active buff display, statistics, and leaderboard data.

Output: Extended guild.ts with buff types, statistics types, leaderboard types, and WebSocket payload types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-guild-shop-statistics/06-RESEARCH.md
@packages/shared/src/types/guild.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add guild buff types</name>
  <files>packages/shared/src/types/guild.ts</files>
  <action>
Append after the Guild Quest types section:

```typescript
// ================================
// Guild Shop & Buff Types
// ================================

// Buff type enum
export type GuildBuffType = 'xp_bonus' | 'catch_rate' | 'encounter_rate'

// Active buff data
export interface GuildBuff {
  id: string
  guild_id: string
  buff_type: GuildBuffType
  multiplier: number  // e.g., 1.10 for +10%
  started_at: string
  ends_at: string
  purchased_by: string | null
  purchased_by_username: string | null
}

// Active buffs state (keyed by buff type for easy lookup)
export interface ActiveGuildBuffs {
  xp_bonus: GuildBuff | null
  catch_rate: GuildBuff | null
  encounter_rate: GuildBuff | null
}

// Buff purchase history entry
export interface GuildBuffPurchase {
  id: string
  buff_type: GuildBuffType
  duration_hours: number
  cost_currency: number | null
  cost_guild_points: number | null
  purchased_by: string
  purchased_by_username: string
  purchased_at: string
}

// Shop item definition (for UI display)
export interface GuildShopItem {
  buff_type: GuildBuffType
  name: string
  description: string
  cost_currency_per_hour: number
  cost_guild_points_per_hour: number
  multiplier: number
  max_duration_hours: number
}
```
  </action>
  <verify>
Run: `grep -c "GuildBuffType\|GuildBuff\|ActiveGuildBuffs" packages/shared/src/types/guild.ts` shows at least 3 matches.
  </verify>
  <done>
Buff types defined: GuildBuffType enum, GuildBuff interface, ActiveGuildBuffs, GuildBuffPurchase, GuildShopItem.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add guild statistics and leaderboard types</name>
  <files>packages/shared/src/types/guild.ts</files>
  <action>
Append after buff types:

```typescript
// ================================
// Guild Statistics Types
// ================================

// Full statistics for a guild
export interface GuildStatistics {
  total_catches: number
  unique_species: number
  member_count: number
  avg_level: number
  days_active: number
  created_at: string
  guild_points: number
}

// Leaderboard metric options
export type LeaderboardMetric = 'catches' | 'pokedex' | 'members'

// Single leaderboard entry
export interface GuildLeaderboardEntry {
  rank: number
  id: string
  name: string
  tag: string
  value: number
  leader_name: string
}

// Player's guild rank info
export interface GuildRankInfo {
  guild_id: string
  guild_name: string
  metric: LeaderboardMetric
  rank: number
  value: number
}
```
  </action>
  <verify>
Run: `grep -c "GuildStatistics\|LeaderboardMetric\|GuildLeaderboardEntry" packages/shared/src/types/guild.ts` shows at least 3 matches.
  </verify>
  <done>
Statistics types defined: GuildStatistics interface, LeaderboardMetric type, GuildLeaderboardEntry, GuildRankInfo.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add WebSocket payload types for shop and statistics</name>
  <files>packages/shared/src/types/guild.ts</files>
  <action>
Append after statistics types:

```typescript
// ================================
// Guild Shop WebSocket Payloads
// ================================

// Client -> Server payloads

// Purchase a buff
export interface PurchaseGuildBuffPayload {
  buff_type: GuildBuffType
  duration_hours: number  // 1-24
  use_guild_points?: boolean  // Default false (use currency)
}

// Get active buffs
export interface GetActiveBuffsPayload {
  // Empty - requests current active buffs
}

// Get guild statistics
export interface GetGuildStatisticsPayload {
  // Empty - requests guild statistics
}

// Get leaderboard
export interface GetGuildLeaderboardPayload {
  metric: LeaderboardMetric
  limit?: number  // Default 50, max 50
}

// Server -> Client payloads

// Active buffs response
export interface GuildActiveBuffsPayload {
  buffs: ActiveGuildBuffs
}

// Buff purchased broadcast
export interface GuildBuffPurchasedPayload {
  buff: GuildBuff
  remaining_currency: number
  remaining_guild_points: number
  purchased_by: string
  purchased_by_username: string
}

// Buff expired notification
export interface GuildBuffExpiredPayload {
  buff_type: GuildBuffType
}

// Statistics response
export interface GuildStatisticsPayload {
  statistics: GuildStatistics
}

// Leaderboard response
export interface GuildLeaderboardPayload {
  metric: LeaderboardMetric
  entries: GuildLeaderboardEntry[]
  my_guild_rank: GuildRankInfo | null
}

// Shop error response
export interface GuildShopErrorPayload {
  error: string
  code?: string
}
```
  </action>
  <verify>
Run: `grep -c "Payload" packages/shared/src/types/guild.ts | tail -1` shows increased payload count.
  </verify>
  <done>
WebSocket payloads defined: PurchaseGuildBuffPayload, GetActiveBuffsPayload, GetGuildStatisticsPayload, GetGuildLeaderboardPayload for client->server. GuildActiveBuffsPayload, GuildBuffPurchasedPayload, GuildBuffExpiredPayload, GuildStatisticsPayload, GuildLeaderboardPayload for server->client.
  </done>
</task>

</tasks>

<verification>
1. guild.ts compiles without TypeScript errors
2. Contains GuildBuffType union type
3. Contains GuildBuff interface with all required fields
4. Contains ActiveGuildBuffs keyed by buff type
5. Contains GuildStatistics with 7 fields
6. Contains LeaderboardMetric union type
7. Contains GuildLeaderboardEntry with rank, name, tag, value, leader_name
8. Contains all WebSocket payload types (5 client->server, 5 server->client)
</verification>

<success_criteria>
- All buff types defined and exported
- All statistics types defined and exported
- All leaderboard types defined and exported
- All WebSocket payloads defined for both directions
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-guild-shop-statistics/06-02-SUMMARY.md`
</output>
