---
phase: 02-guild-invites
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/types/guild.ts
autonomous: true

must_haves:
  truths:
    - "GuildInvite type includes all required fields"
    - "WebSocket payload types exist for send/accept/decline/cancel"
    - "Types are exported from @pokemon-idle/shared"
    - "Types compile without errors"
  artifacts:
    - path: "packages/shared/src/types/guild.ts"
      provides: "Guild invite type definitions"
      exports: ["GuildInvite", "SendGuildInvitePayload", "AcceptGuildInvitePayload"]
  key_links:
    - from: "GuildInvite"
      to: "guild_invites table"
      via: "field mapping"
      pattern: "guild_id.*string"
---

# Plan 02: Shared Types for Guild Invites

## Objective

Add TypeScript type definitions for the guild invite system to the existing guild.ts types file in the shared package.

Purpose: Shared types ensure consistency between database schema, game server handlers, and frontend components for the invite feature.

Output: Updated `guild.ts` with GuildInvite interface and all WebSocket payload interfaces for invite operations.

## Context

**Existing file:** `packages/shared/src/types/guild.ts` already contains:
- GuildRole, GuildJoinMode types
- Guild, GuildPreview, GuildMember, PlayerGuildInfo interfaces
- WebSocket payloads for create/join/leave/search/role operations

**Database schema alignment (from 02-01-PLAN):**
- guild_invites: id, guild_id, player_id, invited_by, created_at, expires_at

**WebSocket messages needed (from CONTEXT.md):**
- Client -> Server: guild_invite_send, guild_invite_accept, guild_invite_decline, guild_invite_cancel
- Server -> Client: guild_invite_received, guild_invites_list, guild_invite_sent, guild_invite_accepted

## Tasks

<task type="auto">
  <name>Task 1: Add guild invite types to guild.ts</name>
  <files>packages/shared/src/types/guild.ts</files>
  <action>
Append the following types to the END of `packages/shared/src/types/guild.ts` (after GuildErrorPayload):

```typescript

// ================================
// Guild Invite Types
// ================================

// Invite data (for displaying pending invites)
export interface GuildInvite {
  id: string
  guild_id: string
  guild_name: string
  guild_tag: string
  member_count: number
  max_members: number
  invited_by: string | null
  invited_by_username: string
  created_at: string
  expires_at: string
}

// Outgoing invite (for guild staff viewing sent invites)
export interface GuildOutgoingInvite {
  id: string
  player_id: string
  player_username: string
  invited_by: string
  invited_by_username: string
  created_at: string
  expires_at: string
}

// ================================
// Guild Invite WebSocket Payloads
// ================================

// Client -> Server payloads

export interface SendGuildInvitePayload {
  player_id: string
}

export interface AcceptGuildInvitePayload {
  invite_id: string
}

export interface DeclineGuildInvitePayload {
  invite_id: string
}

export interface CancelGuildInvitePayload {
  invite_id: string
}

export interface GetGuildInvitesPayload {
  // Empty - just requests list of pending invites
}

// Server -> Client payloads

export interface GuildInviteSentPayload {
  success: boolean
  player_id: string
  player_username: string
}

export interface GuildInviteReceivedPayload {
  invite_id: string
  guild_id: string
  guild_name: string
  guild_tag: string
  member_count: number
  max_members: number
  invited_by_id: string
  invited_by_username: string
  created_at: string
  expires_at: string
}

export interface GuildInvitesListPayload {
  invites: GuildInvite[]
}

export interface GuildOutgoingInvitesPayload {
  invites: GuildOutgoingInvite[]
}

export interface GuildInviteAcceptedPayload {
  guild_id: string
  guild_name: string
}

export interface GuildInviteDeclinedPayload {
  invite_id: string
}

export interface GuildInviteCancelledPayload {
  invite_id: string
}

// Notification when someone accepts an invite (sent to guild members)
export interface GuildMemberJoinedViaInvitePayload {
  player_id: string
  username: string
  invited_by_id: string
  invited_by_username: string
}
```

Note: Follow existing patterns:
- Use string for UUIDs (not branded types)
- Use string for timestamps (ISO format)
- Keep interfaces flat
- Use null for optional database fields, undefined for optional message fields
  </action>
  <verify>Run `npm run build` in packages/shared to verify types compile without errors.</verify>
  <done>Guild invite types added to guild.ts with all interfaces matching database schema and WebSocket message patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Verify exports and build</name>
  <files>packages/shared/src/types/guild.ts</files>
  <action>
Since guild.ts is already exported via the barrel files (set up in Phase 1), no additional export configuration is needed.

1. **Verify build succeeds:**
```bash
cd packages/shared && npm run build
```

2. **Verify types are accessible:**
The new types should automatically be available via:
```typescript
import { GuildInvite, SendGuildInvitePayload } from '@pokemon-idle/shared'
```

No changes needed to index.ts files - the new types are automatically included because guild.ts is already exported.
  </action>
  <verify>Run `npm run build` in packages/shared. Verify build succeeds with no type errors.</verify>
  <done>Guild invite types exported from @pokemon-idle/shared. Build passes without errors.</done>
</task>

## Verification

- [ ] Types appended to `packages/shared/src/types/guild.ts`
- [ ] File exports GuildInvite, GuildOutgoingInvite interfaces
- [ ] File exports SendGuildInvitePayload, AcceptGuildInvitePayload, DeclineGuildInvitePayload, CancelGuildInvitePayload
- [ ] File exports GuildInviteSentPayload, GuildInviteReceivedPayload, GuildInvitesListPayload
- [ ] File exports GuildInviteAcceptedPayload, GuildInviteDeclinedPayload, GuildInviteCancelledPayload
- [ ] File exports GuildMemberJoinedViaInvitePayload
- [ ] `npm run build` in packages/shared completes without errors
- [ ] Types can be imported: `import { GuildInvite } from '@pokemon-idle/shared'`

## Success Criteria

- Guild invite types are available for import in both apps/web and apps/game-server
- Type definitions match the database schema from 023_guild_invites.sql
- WebSocket message payloads cover all Phase 2 invite operations:
  - guild_invite_send, guild_invite_accept, guild_invite_decline, guild_invite_cancel
  - guild_invite_received, guild_invites_list, guild_invite_sent
  - guild_invite_accepted, guild_invite_declined, guild_invite_cancelled

## Output

After completion, create `.planning/phases/02-guild-invites/02-02-SUMMARY.md`
