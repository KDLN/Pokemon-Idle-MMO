---
phase: 09-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/lib/ui/cn.ts
  - apps/web/src/lib/ui/index.ts
  - apps/web/.storybook/main.ts
  - apps/web/.storybook/preview.ts
autonomous: true

must_haves:
  truths:
    - "CVA, clsx, and tailwind-merge are installed as dependencies"
    - "cn() utility uses tailwind-merge to resolve class conflicts"
    - "Storybook 10 starts and loads without errors"
    - "Tailwind CSS styles are applied in Storybook preview"
  artifacts:
    - path: "apps/web/src/lib/ui/cn.ts"
      provides: "cn() utility with tailwind-merge"
      exports: ["cn"]
    - path: "apps/web/.storybook/main.ts"
      provides: "Storybook configuration"
      contains: "@storybook/nextjs-vite"
    - path: "apps/web/.storybook/preview.ts"
      provides: "Storybook preview configuration"
      contains: "globals.css"
  key_links:
    - from: "apps/web/src/lib/ui/index.ts"
      to: "apps/web/src/lib/ui/cn.ts"
      via: "export"
      pattern: "export.*from.*cn"
    - from: "apps/web/.storybook/preview.ts"
      to: "apps/web/src/app/globals.css"
      via: "import"
      pattern: "import.*globals\\.css"
---

<objective>
Set up design system foundation: install CVA dependencies, upgrade cn() utility with tailwind-merge, and configure Storybook 10.

Purpose: Create the tooling foundation that enables CVA component patterns and Storybook documentation in subsequent plans.
Output: Working Storybook 10 instance, cn() utility with tailwind-merge, CVA/clsx/tailwind-merge packages installed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-design-system/09-RESEARCH.md
@.planning/phases/09-design-system/09-CONTEXT.md
@apps/web/src/lib/ui/index.ts
@apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install CVA and utility dependencies</name>
  <files>apps/web/package.json</files>
  <action>
Install required packages in apps/web directory:

Production dependencies:
- class-variance-authority (^0.7.1) - CVA for type-safe component variants
- tailwind-merge (^2.x) - Merge Tailwind classes without conflicts
- clsx (^2.x) - Conditional class joining

Dev dependencies:
- @storybook/nextjs-vite (^10.x) - Storybook framework for Next.js with Vite
- @storybook/addon-docs (^10.x) - Documentation addon
- @storybook/addon-themes (^10.x) - Theme switching addon
- storybook (^10.x) - Core Storybook package

Run: cd apps/web && npm install class-variance-authority tailwind-merge clsx
Run: cd apps/web && npm install -D @storybook/nextjs-vite @storybook/addon-docs @storybook/addon-themes storybook

Add Storybook scripts to package.json:
- "storybook": "storybook dev -p 6006"
- "build-storybook": "storybook build"
  </action>
  <verify>npm list class-variance-authority tailwind-merge clsx @storybook/nextjs-vite shows all packages installed</verify>
  <done>All packages are in package.json dependencies/devDependencies and installed</done>
</task>

<task type="auto">
  <name>Task 2: Create cn() utility with tailwind-merge</name>
  <files>apps/web/src/lib/ui/cn.ts, apps/web/src/lib/ui/index.ts</files>
  <action>
Create new file: apps/web/src/lib/ui/cn.ts

```typescript
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

/**
 * Utility for merging class names with Tailwind conflict resolution.
 * Combines clsx for conditional classes with tailwind-merge for deduplication.
 *
 * @example
 * cn("px-4 py-2", "px-6") // Returns "py-2 px-6" (px-6 wins)
 * cn("text-red-500", condition && "text-blue-500") // Conditional classes
 * cn(baseClasses, variantClasses, className) // CVA pattern
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

Update apps/web/src/lib/ui/index.ts:
- Remove the existing simple cn() function (currently lines 303-305)
- Add export: `export { cn } from './cn'`
- Keep all other exports unchanged
  </action>
  <verify>
TypeScript compiles without errors: cd apps/web && npx tsc --noEmit
Import works: The cn export is available from '@/lib/ui'
  </verify>
  <done>cn.ts exists with tailwind-merge, index.ts re-exports it, old cn() removed</done>
</task>

<task type="auto">
  <name>Task 3: Configure Storybook 10 with Next.js + Tailwind</name>
  <files>apps/web/.storybook/main.ts, apps/web/.storybook/preview.ts</files>
  <action>
Create apps/web/.storybook directory if it doesn't exist.

Create apps/web/.storybook/main.ts:
```typescript
import type { StorybookConfig } from "@storybook/nextjs-vite";

const config: StorybookConfig = {
  stories: [
    "../src/**/*.mdx",
    "../src/**/*.stories.@(js|jsx|mjs|ts|tsx)"
  ],
  addons: [
    "@storybook/addon-docs",
    "@storybook/addon-themes",
  ],
  framework: {
    name: "@storybook/nextjs-vite",
    options: {},
  },
  staticDirs: ["../public"],
};

export default config;
```

Create apps/web/.storybook/preview.ts:
```typescript
import type { Preview } from "@storybook/react";
import { withThemeByDataAttribute } from "@storybook/addon-themes";
import "../src/app/globals.css";

const preview: Preview = {
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    backgrounds: {
      default: 'dark',
      values: [
        { name: 'dark', value: '#0f0f1a' },
        { name: 'light', value: '#ffffff' },
      ],
    },
    layout: 'centered',
  },
  decorators: [
    withThemeByDataAttribute({
      themes: {
        dark: "dark",
      },
      defaultTheme: "dark",
      attributeName: "data-theme",
    }),
  ],
};

export default preview;
```

Note: Using dark theme only since the app is dark-mode only. Theme switching infrastructure is there for future use.
  </action>
  <verify>
Run: cd apps/web && npm run storybook
Storybook starts on port 6006 without errors.
Browser shows Storybook UI with dark background (from globals.css).
  </verify>
  <done>Storybook 10 runs, loads globals.css, shows dark theme background</done>
</task>

</tasks>

<verification>
1. cd apps/web && npm list class-variance-authority tailwind-merge clsx @storybook/nextjs-vite - all packages installed
2. cd apps/web && npx tsc --noEmit - no TypeScript errors
3. cd apps/web && npm run storybook - starts without errors
4. Open http://localhost:6006 - Storybook UI loads with dark background (CSS applied)
</verification>

<success_criteria>
- class-variance-authority, tailwind-merge, clsx installed as dependencies
- @storybook/nextjs-vite, @storybook/addon-docs, @storybook/addon-themes installed as devDependencies
- cn() utility in apps/web/src/lib/ui/cn.ts uses clsx + tailwind-merge
- apps/web/src/lib/ui/index.ts exports cn from new file
- .storybook/main.ts and .storybook/preview.ts exist with correct configuration
- npm run storybook starts Storybook 10 without errors
- Storybook preview shows dark background from globals.css
</success_criteria>

<output>
After completion, create `.planning/phases/09-design-system/09-01-SUMMARY.md`
</output>
