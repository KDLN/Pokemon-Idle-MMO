---
phase: 09-design-system
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - apps/web/src/components/ui/Button.tsx
  - apps/web/src/components/ui/Card.tsx
  - apps/web/src/components/ui/Badge.tsx
autonomous: true

must_haves:
  truths:
    - "Button component uses CVA for type-safe variants"
    - "Card component uses CVA for type-safe variants"
    - "Badge component uses CVA for type-safe variants"
    - "All components export their variant definitions for reuse"
    - "TypeScript autocomplete works for variant props"
  artifacts:
    - path: "apps/web/src/components/ui/Button.tsx"
      provides: "Button component with CVA"
      exports: ["Button", "IconButton", "buttonVariants"]
    - path: "apps/web/src/components/ui/Card.tsx"
      provides: "Card component with CVA"
      exports: ["Card", "CardHeader", "cardVariants"]
    - path: "apps/web/src/components/ui/Badge.tsx"
      provides: "Badge component with CVA"
      exports: ["Badge", "TypeBadge", "badgeVariants"]
  key_links:
    - from: "apps/web/src/components/ui/Button.tsx"
      to: "apps/web/src/lib/ui/cn.ts"
      via: "import"
      pattern: "import.*cn.*from"
    - from: "apps/web/src/components/ui/Button.tsx"
      to: "class-variance-authority"
      via: "import"
      pattern: "import.*cva.*from.*class-variance-authority"
---

<objective>
Migrate Button, Card, and Badge components from manual variant objects to CVA (class-variance-authority) patterns with proper TypeScript types.

Purpose: Enable type-safe component variants with autocomplete, consistent patterns across components, and exported variant definitions for style reuse.
Output: Three refactored components using CVA, each exporting their variant definitions alongside the component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-design-system/09-RESEARCH.md
@.planning/phases/09-design-system/09-CONTEXT.md
@apps/web/src/components/ui/Button.tsx
@apps/web/src/components/ui/Card.tsx
@apps/web/src/components/ui/Badge.tsx
@apps/web/src/lib/ui/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Button component to CVA</name>
  <files>apps/web/src/components/ui/Button.tsx</files>
  <action>
Refactor Button.tsx to use CVA pattern:

```typescript
'use client'

import { cva, type VariantProps } from "class-variance-authority"
import { cn } from '@/lib/ui/cn'

/**
 * Button variant definitions using CVA.
 * Exported for style reuse (e.g., links styled as buttons).
 */
export const buttonVariants = cva(
  // Base classes applied to all variants
  [
    "inline-flex items-center justify-center gap-2 rounded-xl font-medium",
    "transition-all duration-200",
    "disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100",
  ],
  {
    variants: {
      variant: {
        primary: [
          "bg-gradient-to-b from-[var(--color-brand-primary)] to-[var(--color-brand-primary-dark)] text-white",
          "border border-[var(--color-brand-primary-light)]/30",
          "hover:from-[#4B5CDA] hover:to-[var(--color-brand-primary)]",
          "active:scale-95",
          "shadow-lg shadow-[var(--color-brand-primary)]/20",
        ],
        secondary: [
          "bg-gradient-to-b from-[var(--color-surface-elevated)] to-[var(--color-surface-base)] text-white",
          "border border-[var(--color-border-subtle)]",
          "hover:border-[var(--color-border-bright)] hover:from-[var(--color-surface-hover)]",
          "active:scale-95",
        ],
        ghost: [
          "bg-transparent text-[var(--color-text-secondary)]",
          "hover:bg-[var(--color-surface-elevated)] hover:text-white",
          "active:scale-95",
        ],
        danger: [
          "bg-gradient-to-b from-[var(--color-brand-secondary)] to-[var(--color-brand-secondary-dark)] text-white",
          "border border-[var(--color-brand-secondary-light)]/30",
          "hover:from-[#FF2222] hover:to-[var(--color-brand-secondary)]",
          "active:scale-95",
          "shadow-lg shadow-red-900/30",
        ],
        pokeball: [
          "bg-gradient-to-b from-[var(--color-brand-secondary)] to-[var(--color-brand-secondary-dark)] text-white",
          "border-2 border-[var(--color-brand-secondary-light)]/50",
          "hover:from-[#FF2222] hover:to-[var(--color-brand-secondary)]",
          "active:scale-95",
          "shadow-lg shadow-red-900/30",
          "font-semibold",
        ],
      },
      size: {
        sm: "px-3 py-1.5 text-xs",
        md: "px-4 py-2 text-sm",
        lg: "px-6 py-3 text-base",
        icon: "w-10 h-10",
      },
    },
    defaultVariants: {
      variant: "primary",
      size: "md",
    },
  }
)

interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  loading?: boolean
}

export function Button({
  children,
  variant,
  size,
  loading,
  disabled,
  className,
  ...props
}: ButtonProps) {
  return (
    <button
      disabled={disabled || loading}
      className={cn(buttonVariants({ variant, size }), className)}
      {...props}
    >
      {loading && (
        <svg
          className="w-4 h-4 animate-spin"
          viewBox="0 0 24 24"
          fill="none"
        >
          <circle
            className="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            strokeWidth="4"
          />
          <path
            className="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          />
        </svg>
      )}
      {children}
    </button>
  )
}

// Icon Button for compact icon-only buttons
interface IconButtonProps extends Omit<ButtonProps, 'size'> {
  icon: React.ReactNode
  label: string
}

export function IconButton({ icon, label, className, ...props }: IconButtonProps) {
  return (
    <Button
      size="icon"
      className={cn('rounded-full', className)}
      title={label}
      aria-label={label}
      {...props}
    >
      {icon}
    </Button>
  )
}
```

Key changes:
- Import cva and VariantProps from class-variance-authority
- Import cn from '@/lib/ui/cn' (new path)
- Convert sizeClasses and variantClasses objects to single buttonVariants cva() call
- Use CSS variable tokens (--color-brand-primary, etc.) instead of hardcoded hex values
- Export buttonVariants for reuse
- Add VariantProps<typeof buttonVariants> to ButtonProps interface
  </action>
  <verify>
cd apps/web && npx tsc --noEmit - no TypeScript errors
Autocomplete works: variant prop shows primary|secondary|ghost|danger|pokeball
  </verify>
  <done>Button.tsx uses CVA, exports buttonVariants, TypeScript types work</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Card component to CVA</name>
  <files>apps/web/src/components/ui/Card.tsx</files>
  <action>
Refactor Card.tsx to use CVA pattern:

```typescript
'use client'

import { cva, type VariantProps } from "class-variance-authority"
import { cn } from '@/lib/ui/cn'

/**
 * Card variant definitions using CVA.
 * Exported for style reuse.
 */
export const cardVariants = cva(
  // Base classes
  "rounded-xl overflow-hidden",
  {
    variants: {
      variant: {
        default: "bg-[var(--color-surface-elevated)] border border-[var(--color-border-subtle)]",
        glass: "glass border border-[var(--color-border-subtle)]",
        bordered: "poke-border",
      },
      padding: {
        none: "",
        sm: "p-2 sm:p-3",
        md: "p-3 sm:p-4",
        lg: "p-4 sm:p-6",
      },
    },
    defaultVariants: {
      variant: "default",
      padding: "md",
    },
  }
)

interface CardProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof cardVariants> {}

export function Card({
  children,
  className,
  variant,
  padding,
  ...props
}: CardProps) {
  return (
    <div
      className={cn(cardVariants({ variant, padding }), className)}
      {...props}
    >
      {children}
    </div>
  )
}

// Card Header component for consistent headers
interface CardHeaderProps {
  icon?: React.ReactNode
  title: string
  subtitle?: string
  action?: React.ReactNode
  className?: string
}

export function CardHeader({
  icon,
  title,
  subtitle,
  action,
  className,
}: CardHeaderProps) {
  return (
    <div className={cn('flex items-center justify-between', className)}>
      <div className="flex items-center gap-2 sm:gap-3">
        {icon && (
          <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-[var(--color-brand-secondary)] to-[var(--color-brand-secondary-dark)] flex items-center justify-center text-white flex-shrink-0">
            {icon}
          </div>
        )}
        <div>
          <h2 className="font-pixel text-[10px] sm:text-xs text-white tracking-wider uppercase">{title}</h2>
          {subtitle && <p className="text-[9px] sm:text-[10px] text-[var(--color-text-muted)]">{subtitle}</p>}
        </div>
      </div>
      {action}
    </div>
  )
}
```

Key changes:
- Import cva and VariantProps
- Import cn from new path
- Convert paddingClasses and variantClasses to cardVariants cva() call
- Use CSS variable tokens
- Export cardVariants
- Extend HTMLDivElement attributes and VariantProps
  </action>
  <verify>
cd apps/web && npx tsc --noEmit - no TypeScript errors
Autocomplete works: variant prop shows default|glass|bordered, padding shows none|sm|md|lg
  </verify>
  <done>Card.tsx uses CVA, exports cardVariants, TypeScript types work</done>
</task>

<task type="auto">
  <name>Task 3: Migrate Badge component to CVA</name>
  <files>apps/web/src/components/ui/Badge.tsx</files>
  <action>
Refactor Badge.tsx to use CVA pattern:

```typescript
'use client'

import { cva, type VariantProps } from "class-variance-authority"
import { cn, getTypeColor } from '@/lib/ui'

/**
 * Badge variant definitions using CVA.
 * Exported for style reuse.
 */
export const badgeVariants = cva(
  // Base classes
  "inline-flex items-center font-bold uppercase tracking-wide rounded",
  {
    variants: {
      variant: {
        default: "bg-[var(--color-border-subtle)] text-[var(--color-text-secondary)]",
        success: "bg-green-500/20 text-green-400 border border-green-500/30",
        warning: "bg-amber-500/20 text-amber-400 border border-amber-500/30",
        error: "bg-red-500/20 text-red-400 border border-red-500/30",
        shiny: "bg-gradient-to-r from-yellow-400 to-yellow-500 text-black",
        // Note: 'type' variant handled separately due to dynamic color
      },
      size: {
        sm: "text-[10px] px-1.5 py-0.5",
        md: "text-xs px-2 py-1",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "sm",
    },
  }
)

interface BadgeProps
  extends React.HTMLAttributes<HTMLSpanElement>,
    VariantProps<typeof badgeVariants> {
  /** Pokemon type for 'type' variant - sets background color dynamically */
  type?: string
}

export function Badge({
  children,
  variant,
  type,
  size,
  className,
  ...props
}: BadgeProps) {
  // Handle 'type' variant separately due to dynamic backgroundColor
  if (variant === 'type' || (type && !variant)) {
    const sizeClasses = size === 'md' ? 'text-xs px-2 py-1' : 'text-[10px] px-1.5 py-0.5'
    return (
      <span
        className={cn(
          "inline-flex items-center font-bold uppercase tracking-wide rounded text-white shadow-sm",
          sizeClasses,
          className
        )}
        style={{ backgroundColor: getTypeColor(type || 'normal') }}
        {...props}
      >
        {children}
      </span>
    )
  }

  return (
    <span
      className={cn(badgeVariants({ variant, size }), className)}
      {...props}
    >
      {children}
    </span>
  )
}

// Type Badge - specifically for Pokemon types
interface TypeBadgeProps extends Omit<BadgeProps, 'variant' | 'type'> {
  type: string
}

export function TypeBadge({ type, size = 'sm', className, ...props }: TypeBadgeProps) {
  return (
    <Badge type={type} size={size} className={className} {...props}>
      {type}
    </Badge>
  )
}
```

Key changes:
- Import cva and VariantProps
- Create badgeVariants with default, success, warning, error, shiny variants
- Handle 'type' variant separately (dynamic color via style prop, not CVA)
- Export badgeVariants
- Keep getTypeColor import from @/lib/ui for backward compatibility
- Update TypeBadge to use Badge with type prop

Note: The 'type' variant for Pokemon types uses dynamic backgroundColor via style prop because CVA doesn't support runtime-determined values. This is the recommended pattern from CVA docs.
  </action>
  <verify>
cd apps/web && npx tsc --noEmit - no TypeScript errors
Autocomplete works: variant prop shows default|success|warning|error|shiny
TypeBadge still renders Pokemon type colors correctly
  </verify>
  <done>Badge.tsx uses CVA, exports badgeVariants, TypeBadge works, TypeScript types work</done>
</task>

</tasks>

<verification>
1. cd apps/web && npx tsc --noEmit - all three components type-check
2. npm run build - no build errors
3. npm run dev - visual check that buttons, cards, badges render correctly
4. Check TypeScript autocomplete in IDE for variant props
5. Verify exports: grep "export.*buttonVariants\|cardVariants\|badgeVariants" apps/web/src/components/ui/*.tsx
</verification>

<success_criteria>
- Button.tsx uses cva() for variant definitions, exports buttonVariants
- Card.tsx uses cva() for variant definitions, exports cardVariants
- Badge.tsx uses cva() for variant definitions, exports badgeVariants
- All components import cn from '@/lib/ui/cn'
- All components use CSS variable tokens (--color-*) where applicable
- TypeScript compiles without errors
- VariantProps provides autocomplete for variant/size props
- Application visuals unchanged (components render identically)
</success_criteria>

<output>
After completion, create `.planning/phases/09-design-system/09-03-SUMMARY.md`
</output>
