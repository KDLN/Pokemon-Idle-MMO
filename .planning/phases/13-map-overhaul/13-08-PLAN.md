---
phase: 13-map-overhaul
plan: 08
type: execute
wave: 6
depends_on: ["13-07"]
files_modified:
  - apps/web/src/components/game/map/index.ts
  - apps/web/src/components/layout/LayoutB.tsx
  - apps/web/src/components/game/ZoneDisplay.tsx
autonomous: true

must_haves:
  truths:
    - "Interactive map replaces static map in game layout"
    - "Map appears in map-sidebar section of LayoutB"
    - "Existing travel buttons in ZoneDisplay still work"
  artifacts:
    - path: "apps/web/src/components/game/map/index.ts"
      provides: "Barrel export for map components"
      exports: ["InteractiveMap"]
  key_links:
    - from: "LayoutB.tsx"
      to: "InteractiveMap"
      via: "import and render in map-sidebar"
      pattern: "InteractiveMap"
---

<objective>
Integrate the interactive map into the main game layout, replacing the static map display.

Purpose: Make the new map accessible to players in the actual game interface.
Output: Interactive map displayed in the game's map sidebar, fully functional.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-map-overhaul/13-07-SUMMARY.md
@apps/web/src/components/layout/LayoutB.tsx
@apps/web/src/components/game/ZoneDisplay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create barrel export and verify component structure</name>
  <files>apps/web/src/components/game/map/index.ts</files>
  <action>
    Create index.ts barrel export for map components:

    1. Create apps/web/src/components/game/map/index.ts:
       ```typescript
       export { InteractiveMap } from './InteractiveMap'
       export { MapCanvas } from './MapCanvas'
       export { MapControls } from './MapControls'
       export { MapFrame } from './MapFrame'
       export { ZoneNode } from './ZoneNode'
       export { ZoneConnection } from './ZoneConnection'
       export { ConnectionLayer } from './ConnectionLayer'
       export { ZoneTooltip } from './ZoneTooltip'
       export * from './mapTypes'
       export * from './mapUtils'
       ```

    2. Verify all components are properly exported:
       - Each component file has named export
       - No circular dependencies
  </action>
  <verify>
    - index.ts exports all map components
    - `import { InteractiveMap } from '@/components/game/map'` works
    - No TypeScript errors on import
  </verify>
  <done>Map components have clean barrel export</done>
</task>

<task type="auto">
  <name>Task 2: Integrate InteractiveMap into LayoutB</name>
  <files>apps/web/src/components/layout/LayoutB.tsx</files>
  <action>
    Add interactive map to the game layout:

    1. Read existing LayoutB.tsx to understand structure

    2. Find the map-sidebar section:
       - Currently contains: .map-canvas with basic dots/lines

    3. Replace static map with InteractiveMap:
       - Import InteractiveMap from '@/components/game/map'
       - Replace .map-canvas content with <InteractiveMap />
       - Ensure proper sizing within sidebar constraints

    4. Adjust container styling if needed:
       - InteractiveMap should fill available space
       - Maintain aspect ratio on different screen sizes
       - Keep the "CURRENT LOCATION" and travel sections below map

    5. Handle mobile view:
       - Map should work in mobile-active state
       - Touch gestures should function
       - May need to adjust height constraints

    6. Keep existing travel-section and nearby-section:
       - These provide alternative travel UI
       - Map is an additional interface, not replacement for buttons
  </action>
  <verify>
    - LayoutB renders InteractiveMap in map-sidebar
    - Map displays correctly in sidebar dimensions
    - Map interactions work (pan, zoom, click travel)
    - Existing travel buttons still visible and functional
    - Mobile view works correctly
  </verify>
  <done>Interactive map integrated into main game layout</done>
</task>

<task type="auto">
  <name>Task 3: Ensure ZoneDisplay and map work together</name>
  <files>apps/web/src/components/game/ZoneDisplay.tsx</files>
  <action>
    Verify both travel interfaces work harmoniously:

    1. Travel via ZoneDisplay buttons:
       - Should update map (current zone highlighted)
       - Should trigger fog of war reveal
       - Should center map on new zone

    2. Travel via map click:
       - Should update ZoneDisplay current zone
       - Should update travel button list
       - Both use gameSocket.moveToZone - should stay in sync

    3. Check shared state:
       - currentZone from gameStore
       - connectedZones from gameStore
       - visitedZones from gameStore
       - All should update from WebSocket game_state messages

    4. No changes needed to ZoneDisplay if:
       - Both use same gameStore state
       - Both use gameSocket for travel
       - They share the single source of truth

    5. Test bidirectional updates:
       - Travel via map -> ZoneDisplay updates
       - Travel via buttons -> Map updates
  </action>
  <verify>
    - Traveling via map updates ZoneDisplay
    - Traveling via buttons updates map
    - Both interfaces show same current zone
    - No state synchronization issues
  </verify>
  <done>Map and ZoneDisplay work together seamlessly</done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd apps/web && npm run build`
2. No TypeScript errors
3. Integration test:
   - Game loads with map in sidebar
   - Travel via map works
   - Travel via buttons works
   - Both interfaces stay synchronized
   - Mobile layout works
</verification>

<success_criteria>
- InteractiveMap renders in LayoutB map-sidebar
- Map displays within sidebar dimensions correctly
- All map features work in integrated context
- ZoneDisplay and map stay synchronized
- Mobile and desktop layouts both work
</success_criteria>

<output>
After completion, create `.planning/phases/13-map-overhaul/13-08-SUMMARY.md`
</output>
