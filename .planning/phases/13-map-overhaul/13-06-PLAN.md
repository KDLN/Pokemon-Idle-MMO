---
phase: 13-map-overhaul
plan: 06
type: execute
wave: 4
depends_on: ["13-04", "13-05"]
files_modified:
  - apps/web/src/components/game/map/InteractiveMap.tsx
  - apps/web/src/components/game/map/MapCanvas.tsx
  - apps/web/src/components/game/map/ZoneNode.tsx
  - apps/web/src/lib/ws/gameSocket.ts
autonomous: true

must_haves:
  truths:
    - "Clicking a visited connected zone triggers travel"
    - "Clicking a path line triggers travel to the connected zone"
    - "Travel confirmation matches existing ZoneDisplay behavior"
  artifacts:
    - path: "apps/web/src/components/game/map/MapCanvas.tsx"
      provides: "Travel click handler"
      exports: ["MapCanvas"]
    - path: "apps/web/src/components/game/map/ZoneNode.tsx"
      provides: "Zone click triggers travel"
      exports: ["ZoneNode"]
  key_links:
    - from: "ZoneNode.tsx"
      to: "gameSocket.moveToZone"
      via: "onClick handler"
      pattern: "gameSocket\\.moveToZone"
    - from: "MapCanvas.tsx"
      to: "connectedZones"
      via: "validates travel is allowed"
      pattern: "connectedZones\\.some"
---

<objective>
Wire up zone click interactions to trigger travel via the existing WebSocket move_zone message.

Purpose: Make the map a functional navigation tool, not just a display.
Output: Clicking zones or paths on the map moves the player to that zone.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-map-overhaul/13-CONTEXT.md
@.planning/phases/13-map-overhaul/13-02-SUMMARY.md
@.planning/phases/13-map-overhaul/13-04-SUMMARY.md
@apps/web/src/lib/ws/gameSocket.ts
@apps/web/src/components/game/ZoneDisplay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add travel handler to ZoneNode</name>
  <files>apps/web/src/components/game/map/ZoneNode.tsx</files>
  <action>
    Update ZoneNode to handle zone travel:

    1. Add onTravel prop:
       - onTravel: (zoneId: number) => void

    2. Update click handler:
       - If visibility !== 'visited': return early (can't travel to unknown)
       - If zone is current zone: return early (already here)
       - Call onTravel(zone.id)

    3. Update button styling for interactive states:
       - Visited + connected to current: hover-able, cursor-pointer
       - Visited but not connected: still show, but disabled appearance
       - Add visual feedback on click (scale-95 active state)

    4. Accessibility:
       - aria-label: "Travel to {zone.name}"
       - Disabled zones: aria-disabled="true"
  </action>
  <verify>
    - Clicking visited zone calls onTravel with zone ID
    - Clicking current zone does nothing
    - Clicking adjacent unknown zone does nothing
    - Proper aria-labels on all zones
  </verify>
  <done>ZoneNode triggers travel callback on click</done>
</task>

<task type="auto">
  <name>Task 2: Wire travel to gameSocket in MapCanvas</name>
  <files>apps/web/src/components/game/map/MapCanvas.tsx</files>
  <action>
    Connect zone clicks to game server:

    1. Import gameSocket from '@/lib/ws/gameSocket'

    2. Import connectedZones from gameStore:
       - These are zones directly reachable from current zone

    3. Create handleZoneTravel function:
       - Input: zoneId: number
       - Validate zone is in connectedZones (can only travel to adjacent)
       - If not connected: show toast or ignore
       - If connected: call gameSocket.moveToZone(zoneId)

    4. Pass handleZoneTravel to ZoneNode components:
       - As onTravel prop

    5. Add visual feedback for connected zones:
       - Pass isConnected prop to ZoneNode
       - Connected zones: full opacity, interactive
       - Non-connected visited zones: slightly muted, shows as visited but not clickable for travel
  </action>
  <verify>
    - Clicking connected zone sends moveToZone message
    - Clicking non-connected zone does not trigger travel
    - After travel, map updates to show new current zone
    - No errors in console when clicking
  </verify>
  <done>Map travel integrated with WebSocket game server</done>
</task>

<task type="auto">
  <name>Task 3: Add path clicking for travel</name>
  <files>apps/web/src/components/game/map/ZoneConnection.tsx, apps/web/src/components/game/map/ConnectionLayer.tsx</files>
  <action>
    Enable clicking on path lines to travel:

    1. Update ZoneConnection.tsx:
       - Add onClick prop: (targetZoneId: number) => void
       - Remove pointer-events: none from active paths
       - Add clickable <line> with larger stroke-width for easier clicking
       - Or: Add invisible wider line for click target
       - cursor: pointer on active paths
       - onClick: determine which zone to travel to (the one that's NOT current)

    2. Update ConnectionLayer.tsx:
       - Pass onPathClick handler to ZoneConnection
       - Calculate which zone to travel to when path clicked:
         - If from is current, travel to to
         - If to is current, travel to from

    3. Styling for clickable paths:
       - Active paths (connected to current): clickable
       - Other paths: pointer-events none
       - Hover state: thicker stroke, brighter color

    4. CONTEXT.md note: "Clicking a path travels along it (if reachable from current position)"
  </action>
  <verify>
    - Clicking path from current zone triggers travel
    - Only paths connected to current zone are clickable
    - Path hover shows visual feedback
    - Travel works same as clicking zone
  </verify>
  <done>Path lines are clickable for quick travel</done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd apps/web && npm run build`
2. No TypeScript errors
3. Manual test with running game server:
   - Click connected zone - player travels there
   - Click connected path - player travels
   - Zone updates to new location
   - Map re-centers on new position
   - Fog of war updates (new zone revealed)
   - Click non-connected zone - nothing happens
</verification>

<success_criteria>
- Clicking connected zone triggers travel
- Clicking connected path triggers travel
- Non-connected zones/paths are not interactive
- Travel uses existing gameSocket.moveToZone
- Map state updates after travel (position, fog of war)
- No console errors during interactions
</success_criteria>

<output>
After completion, create `.planning/phases/13-map-overhaul/13-06-SUMMARY.md`
</output>
