---
phase: 13-map-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/components/game/map/InteractiveMap.tsx
  - apps/web/src/components/game/map/MapCanvas.tsx
  - apps/web/src/components/game/map/MapControls.tsx
  - apps/web/src/components/game/map/mapTypes.ts
autonomous: true

must_haves:
  truths:
    - "Map container renders and responds to pan/zoom gestures"
    - "Zoom controls (+/-/reset) work on click"
    - "Pinch-to-zoom works on touch devices"
    - "Mouse wheel zoom works on desktop"
  artifacts:
    - path: "apps/web/src/components/game/map/InteractiveMap.tsx"
      provides: "TransformWrapper container with controls"
      exports: ["InteractiveMap"]
    - path: "apps/web/src/components/game/map/MapCanvas.tsx"
      provides: "Content layer for zones and connections"
      exports: ["MapCanvas"]
    - path: "apps/web/src/components/game/map/MapControls.tsx"
      provides: "Zoom +/- buttons and reset"
      exports: ["MapControls"]
    - path: "apps/web/src/components/game/map/mapTypes.ts"
      provides: "TypeScript interfaces for map components"
      exports: ["ZonePosition", "MapProps", "ZoneVisibility"]
  key_links:
    - from: "InteractiveMap.tsx"
      to: "react-zoom-pan-pinch"
      via: "TransformWrapper, TransformComponent"
      pattern: "TransformWrapper"
    - from: "MapControls.tsx"
      to: "react-zoom-pan-pinch"
      via: "useControls hook"
      pattern: "useControls"
---

<objective>
Install react-zoom-pan-pinch and create the foundational map components with pan/zoom functionality.

Purpose: Establish the core interactive map container that enables smooth navigation before adding zone content.
Output: InteractiveMap component with working pan/zoom, MapCanvas content layer, MapControls with +/- buttons.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-map-overhaul/13-CONTEXT.md
@.planning/phases/13-map-overhaul/13-RESEARCH.md
@apps/web/src/app/globals.css
@apps/web/src/components/ui/Tooltip.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-zoom-pan-pinch and create types</name>
  <files>apps/web/package.json, apps/web/src/components/game/map/mapTypes.ts</files>
  <action>
    1. Install react-zoom-pan-pinch v3.7.0:
       ```bash
       cd apps/web && npm install react-zoom-pan-pinch@3.7.0
       ```

    2. Create mapTypes.ts with core interfaces:
       - ZonePosition: { id: number; x: number; y: number }
       - ZoneVisibility: 'visited' | 'adjacent' | 'hidden'
       - MapProps: Props for InteractiveMap component
       - ZoneNodeData: Extended zone info for rendering
       - ConnectionData: Zone connection with direction
  </action>
  <verify>
    - `npm ls react-zoom-pan-pinch` shows 3.7.0 installed
    - mapTypes.ts exists and exports all interfaces
  </verify>
  <done>Package installed, TypeScript interfaces defined for map components</done>
</task>

<task type="auto">
  <name>Task 2: Create MapControls component</name>
  <files>apps/web/src/components/game/map/MapControls.tsx</files>
  <action>
    Create MapControls.tsx that uses useControls() hook from react-zoom-pan-pinch:

    1. Import useControls from react-zoom-pan-pinch
    2. Create three buttons: zoom in (+), zoom out (-), reset
    3. Style with existing design tokens:
       - Position absolute top-4 right-4 z-10
       - Use bg-surface-elevated (from design tokens)
       - 44x44px touch targets (WCAG compliance)
       - Rounded corners, subtle border
       - Hover states matching existing patterns
    4. Use pixel font for button text
    5. Add aria-labels for accessibility
  </action>
  <verify>
    - Component exports MapControls
    - Uses useControls hook
    - Buttons have min 44x44px dimensions
    - Has aria-label on each button
  </verify>
  <done>MapControls renders zoom buttons that integrate with TransformWrapper</done>
</task>

<task type="auto">
  <name>Task 3: Create MapCanvas and InteractiveMap components</name>
  <files>apps/web/src/components/game/map/MapCanvas.tsx, apps/web/src/components/game/map/InteractiveMap.tsx</files>
  <action>
    1. Create MapCanvas.tsx:
       - Placeholder content layer (dark gradient background)
       - Fixed dimensions (800x600 base) with will-change: transform
       - Add "Map loading..." placeholder text centered
       - Style with solid dark background (user decision from CONTEXT.md)

    2. Create InteractiveMap.tsx:
       - Wrap MapCanvas in TransformWrapper + TransformComponent
       - Configure TransformWrapper:
         - initialScale: 1
         - minScale: 0.5
         - maxScale: 2
         - centerOnInit: true
         - limitToBounds: false (allow panning beyond bounds)
         - wheel: { step: 0.1 }
         - pinch: { step: 5 }
       - Include MapControls inside TransformWrapper (for useControls access)
       - Container: relative, full width, aspect-ratio 16/10, max-height 400px
       - Add dark background with subtle gradient matching game theme
       - Add decorative border using poke-border class pattern
  </action>
  <verify>
    - InteractiveMap renders without errors
    - Mouse wheel zooms the content
    - Drag pans the content
    - +/- buttons change zoom level
    - Reset button returns to initial state
  </verify>
  <done>Interactive map foundation with working pan/zoom and controls</done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd apps/web && npm run build`
2. No TypeScript errors in new files
3. Manual test: Import InteractiveMap in a test page, verify:
   - Renders dark canvas area
   - Mouse drag pans content
   - Scroll wheel zooms in/out
   - +/- buttons work
   - Reset button resets view
</verification>

<success_criteria>
- react-zoom-pan-pinch 3.7.0 installed
- InteractiveMap component renders with pan/zoom
- MapControls provides zoom buttons
- All gestures work: drag, pinch, wheel
- Touch targets meet 44px minimum
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-map-overhaul/13-01-SUMMARY.md`
</output>
